<div class='container'>
  <div class='row'>
    <div class='col-md-1'></div>
    <div class='col-md-10'>
      <!-- 本の詳細情報を表示するテーブル -->
    <table class='table table-hover table-inverse'>
      <thead>
        <tr>
          <th></th>
          <th>タイトル</th>
          <th>著者</th>
          <th>出版日</th>
          <th>ISBN</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <!-- 本の画像（リンク） -->
            <td><%= link_to (image_tag(@book.image_url)), @book.image_url if @book %></td>
            <!-- 本の詳細情報 -->
            <td><%= @book.title %></td>
            <td><%= @book.author %></td>
            <td><%= @book.sales_date %></td>
            <td><%= @book.isbn%></td>
        </tr>
      </tbody>
    </table>
      <!-- 星評価のフォーム -->
    <h2>Book review</h2>
    <table class='table table-hover table-inverse'>
      <tr>
        <td>
          <%= form_with model: [@book, @post], url: book_posts_path(@book.isbn) do |f| %>
            <div class="form-group" id="star">
              <%= f.label :star %>
              <%= f.hidden_field :star, id: :review_star, class: 'form-control' %>
              <div id="post_raty"></div>
            </div>
            <!-- Turbolinksを使用して非同期で星評価を表示 -->
            <script>
              $(document).on('turbolinks:load', function() {
                let elem = document.querySelector('#post_raty');
                if (elem == null) return;
  
                elem.innerHTML = ""
                let opt = {  
                  starOn: "<%= asset_path('star-on.png') %>",
                  starOff: "<%= asset_path('star-off.png') %>",
                  starHalf: "<%= asset_path('star-half.png') %>",
                  scoreName: 'book[star]',
                };
                raty(elem, opt);
              });
            </script>
             <!-- 書評送信ボタン -->
          <div class="form-group">
            <%= f.submit class: 'btn btn-success' %>
          </div>
          <% end %>
        </td>
        <td>
           <!-- 書評一覧 -->
          <div>
            <p>コメント件数：<%= @posts.count %></p>
            <% @posts.each do |post| %>
              <%= post.customer.name %>
              <%= post.created_at.strftime('%Y/%m/%d') %>
              <%= post.review %>
            <% end %>
          </div>
          <div>
            <%= form_with model: [@book, @post], url: book_posts_path(@book.isbn) do |f| %>
              <%= f.text_area :review, rows: '5', placeholder: "コメントをここに" %>
              <%= f.submit "送信する" %>
            <% end %>
          </div>
        </td>
      </tr>
    </table>
    </div>
    <div class='col-md-1'></div>
  </div>  
</div>    
