<% seen_tags = [] %>
<% book.posts.joins(:customer).where(customers: { is_active: true }).each do |post| %>
  <% post.tags.each do |tag| %>
    <% unless seen_tags.include?(tag.id) %>
      <%= link_to tag.name, tag_path(tag) %>
      <% seen_tags << tag.id %>
    <% end %>
  <% end %>
<% end %>